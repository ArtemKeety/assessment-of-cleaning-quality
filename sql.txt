

create table users (
	id serial primary key,
	login varchar(100) unique not null,
	password varchar(255) not null,
	is_active BOOLEAN default true
);
create index idx_user_status on users(login) where is_active = true;


create table session (
	guid varchar(255) primary key,
	date timestamp not null,
	agent TEXT not null,
	user_id integer not null,
	foreign key (user_id) references users(id) on delete cascade
);


create table flat(
	id serial primary key,
	user_id integer not null,
	name varchar(255) not null,
	preview varchar(255) not null,
	foreign key (user_id) references users(id) on delete cascade
);
create index user_id_for_flat on flat(user_id);


create table photo(
	id serial primary key,
	path text not null,
	flat_id integer not null,
	foreign key (flat_id) references flat(id) on delete cascade
);
create index flat_for_photo on photo(flat_id);


create table report(
	id serial primary key,
	flat_id integer not null,
	preview varchar(255) not null,
	date timestamp not null,
	foreign key (flat_id) references flat(id) on delete cascade
);
create index flat_for_report on report(flat_id);


create table report_part(
	id serial primary key,
	report_id integer not null,
	info text,
	path text,
	foreign key (report_id) references report(id) on delete cascade
);
create index report_for_photo_report on report(report_id);



